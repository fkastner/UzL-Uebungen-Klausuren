\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{klausur}[2020/06/30 v1.00 Klausuren fuer das Mathe-Institut UzL]

%%%%%%%%%%%%%%%%%%%% PACKAGES %%%%%%%%%%%%%%%%%%%%
\RequirePackage{aufgabenzettel}
%%%%%%%%%%%%%%%%%%%% END PACKAGES %%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%% TITLE INFO %%%%%%%%%%%%%%%%%%%%
%%% Commands to set title info
\DeclareRobustCommand*{\vorlesung}[1]{\gdef\@vorlesung{#1}}
\DeclareRobustCommand*{\datum}[1]{\gdef\@datum{#1}}
%\DeclareRobustCommand*{\}[1]{\gdef\@{#1}}

%%% Default values
\vorlesung{\textbackslash vorlesung}
\datum{\textbackslash datum}
%%%%%%%%%%%%%%%%%%%% END TITLE INFO %%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%% MAKETITLE %%%%%%%%%%%%%%%%%%%%
\renewcommand{\@maketitle}{
    \vspace*{-2cm}
    Universit\"at zu L\"ubeck\\
    Institut f\"ur Mathematik \hfill \@datum\break
    \bigskip\medskip\bigskip
    \begin{center}
        {\large\textbf{Klausur zur Veranstaltung}}\\[.4cm]
        {\Large\textbf{\glqq \@vorlesung\grqq}}%
        \wennLoesung{\\{\Large\textbf{L\"osungen}}}
        \\[2cm]
    \end{center}
    Bitte in Druckschrift deutlich lesbar ausf\"ullen:\\[.75cm]
    \begin{tabularx}{\textwidth}{@{}Xp{0.4\textwidth}}
        Name: \dotfill & Fachrichtung: \dotfill \\[.75cm]
        Vorname: \dotfill & Matrikel-Nr.: \dotfill\\[.75cm]
    \end{tabularx}\\
    Wiederholer: {\Large$\bigcirc$}\\[1.25cm]
}
%%%%%%%%%%%%%%%%%%%% END MAKETITLE %%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%% PUNKTEBLOCK %%%%%%%%%%%%%%%%%%%%
\newcount\punkteblock@numargs
\newcount\punkteblock@sum
\newcount\punkteblock@cline
\newif\ifpunkteblock@correctsum
\def\punkteblock@scanargs#1,#2\relax{%
    \advance\punkteblock@numargs by 1%
    \ifnum0<0#1\relax%
        \advance\punkteblock@sum by #1%
    \else\punkteblock@correctsumfalse\fi%
    \xdef\punkteblock@firstrow{\punkteblock@firstrow & \number\punkteblock@numargs}%
    \xdef\punkteblock@secondrow{\punkteblock@secondrow & #1}%
    \xdef\punkteblock@thirdrow{\punkteblock@thirdrow & }%
    \ifx\relax#2\relax\else\expandafter\punkteblock@scanargs\fi#2\relax%
}
\newcommand*{\punkteblock}[2][0.8\textwidth]{%
    % reset values
    \def\punkteblock@firstrow{Aufgabe}%
    \def\punkteblock@secondrow{max. Punkte}%
    \def\punkteblock@thirdrow{err. Punkte}%
    \punkteblock@numargs=0
    \punkteblock@sum=0
    \punkteblock@correctsumtrue
    % scan the arguments and populate the macros
    \punkteblock@scanargs#2,\relax
    % calculate some numbers
    \punkteblock@cline=\punkteblock@numargs
    \advance\punkteblock@cline by 2% for the length of the cline
    \advance\punkteblock@numargs by 1% to have the right number of columns (including sum column)
    % print the table
    \begin{center}\large
    \begin{tabularx}{#1}{|l|*{\punkteblock@numargs}{>{\centering\arraybackslash}X|}l|}
        \hline
        \punkteblock@firstrow & ~$ \sum $~ & ~Note:~ \\
        \hline
        \punkteblock@secondrow & \ifpunkteblock@correctsum\number\punkteblock@sum\else??\fi & \\
        \cline{1-\punkteblock@cline}
        \punkteblock@thirdrow & & \\[.2cm]
        \hline
    \end{tabularx}
    \end{center}%
}
%%%%%%%%%%%%%%%%%%%% END PUNKTEBLOCK %%%%%%%%%%%%%%%%%%%%


%%%%%%%%%%%%%%%%%%%% ANKREUZBLOCK %%%%%%%%%%%%%%%%%%%%
\newenvironment{ankreuzblock}{%
    \newcommand{\antwort}[2]{%
        \if##1W\relax\wennLoesung{$ \bigotimes $}\wennohneLoesung{$ \bigcirc $}\else$ \bigcirc $\fi%
        &%
        \if##1F\relax\wennLoesung{$ \bigotimes $}\wennohneLoesung{$ \bigcirc $}\else$ \bigcirc $\fi%
        & ##2 \\%
    }
    \tabularx{\linewidth}{ccX}%
    W & F & \\
}{%
    \endtabularx%
}
%%%%%%%%%%%%%%%%%%%% END ANKREUZBLOCK %%%%%%%%%%%%%%%%%%%%


\endinput
